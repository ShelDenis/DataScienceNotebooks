# -*- coding: utf-8 -*-
"""PrmDZ.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ng46uWZ63KhA0sPw0dAzx-qUGvzKoUPR

# –î–ó –ø–æ –ü—Ä–∞–∫—Ç–∏–∫—É–º—É –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é

<a id="toc"></a>

### –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

* [–ß–∞—Å—Ç—å 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö](#chapter1)
    * [–†–∞–∑–¥–µ–ª 1.1. –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö](#section_1_1)
    * [–†–∞–∑–¥–µ–ª 1.2. –ü–µ—Ä–≤–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö](#section_1_2)
    * [–†–∞–∑–¥–µ–ª 1.3. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∫–∏ –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏](#section_1_3)
    * [–†–∞–∑–¥–µ–ª 1.4. –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤](#section_1_4)
    * [–†–∞–∑–¥–µ–ª 1.5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤)](#section_1_5)
    * [–†–∞–∑–¥–µ–ª 1.6. –î–µ—Ç–µ–∫—Ü–∏—è –≤—ã–±—Ä–æ—Å–æ–≤ –∏ –∞–Ω–æ–º–∞–ª–∏–π –≤ –¥–∞–Ω–Ω—ã—Ö](#section_1_6)
    * [–†–∞–∑–¥–µ–ª 1.7. –ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ —Ä–∞–∑–¥–µ–ª–∞ 1](#section_1_7)
* [–ß–∞—Å—Ç—å 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤](#chapter2)
    * [–†–∞–∑–¥–µ–ª 2.1. –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—Ö–æ–¥–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (–ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–µ–ø–ª–æ–≤—ã—Ö –∫–∞—Ä—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏)](#section_2_1)
    * [–†–∞–∑–¥–µ–ª 2.2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –º—É–ª—å—Ç–∏–∫–æ–ª–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç–∏ –≤ –¥–∞–Ω–Ω—ã—Ö](#section_2_2)
    * [–†–∞–∑–¥–µ–ª 2.3. –°–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö](#section_2_3)
    * [–†–∞–∑–¥–µ–ª 2.4. –ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ —Ä–∞–∑–¥–µ–ª–∞ 2](#section_2_4)
* [–ß–∞—Å—Ç—å 3. –í—ã–±–æ—Ä –º–æ–¥–µ–ª–µ–π ML –∏ –º–µ—Ç—Ä–∏–∫](#chapter3)
* [–ß–∞—Å—Ç—å 4. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π ML –∏ –ø–æ–¥–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤](#chapter4)
* [–ß–∞—Å—Ç—å 5. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö](#chapter5)
* [–ß–∞—Å—Ç—å 6. –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã](#chapter6)

–¶–µ–ª—å—é –¥–∞–Ω–Ω–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —è–≤–ª—è–µ—Ç—Å—è: —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `–ì–∞—Ä–º–æ–Ω–∏—è –ë–µ—Å—Å–º–µ—Ä—Ç–∏—è`.
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—É—é –≤–µ–ª–∏—á–∏–Ω—É, –ø–æ—ç—Ç–æ–º—É –∫–ª–∞—Å—Å –∑–∞–¥–∞—á–∏ - —Ä–µ–≥—Ä–µ—Å—Å–∏—è.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø–æ–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞

| –ü–æ–ª–µ                         | –û–ø–∏—Å–∞–Ω–∏–µ                                                                 | –î–∏–∞–ø–∞–∑–æ–Ω               |
|-------------------------------|--------------------------------------------------------------------------|------------------------|
| –í–µ–∫—Ç–æ—Ä –º–æ—â–∏                   | –ü–æ–∑–∏—Ü–∏—è –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞, —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª | 1.138 - 9.300          |
| –°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª | –°–∫–æ—Ä–æ—Å—Ç—å, —Å –∫–æ—Ç–æ—Ä–æ–π –ø–æ—Ä—Ç–∞–ª –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ                | 1.54 - 13.88                      |
| –ü—Ä–∏—Ç–æ–∫ —Å–∏–ª—ã –ø–æ—Ç–æ–∫–∞            | –ü–æ—Ç–æ–∫ –º–∞–≥–∏—á–µ—Å–∫–æ–π —Å–∏–ª—ã, —Ç–µ–∫—É—â–∏–π —á–µ—Ä–µ–∑ —è–¥—Ä–æ –ø–æ—Ä—Ç–∞–ª–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –µ–≥–æ —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É | 253.547 - 72784.872   |
| –†–∏—Ç–º –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞          | –ß–∏—Å–ª–æ –æ–±–æ—Ä–æ—Ç–æ–≤ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞ –ø–æ—Ä—Ç–∞–ª–∞ –≤ –º–∏–Ω—É—Ç—É                          | 136.939 - 372.880     |
| –ü–æ—Ç–æ–∫ —ç–Ω–µ—Ä–≥–∏–π                 | –ß–∏—Å–ª–æ –æ–±–æ—Ä–æ—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —ç—Ñ–∏—Ä–∞, –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—â–µ–≥–æ –≤–Ω–µ—à–Ω—é—é —ç–Ω–µ—Ä–≥–∏—é –≤ –º–∞–≥–∏—á–µ—Å–∫—É—é | 6589.002 - 9797.103   |
| –°–∏–ª–∞ –ª–µ–≤–æ–≥–æ –ø—Ä–∏—Ç–æ–∫–∞           | –ú–æ—â–Ω–æ—Å—Ç—å –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—Ç–æ–∫–∞, —Ç–µ–∫—É—â–µ–≥–æ —á–µ—Ä–µ–∑ –ª–µ–≤—É—é —Å—Ç–æ—Ä–æ–Ω—É –ø–æ—Ä—Ç–∞–ª–∞, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—è –µ–≥–æ –±–∞–ª–∞–Ω—Å | 5.304 - 645.249       |
| –°–∏–ª–∞ –ø—Ä–∞–≤–æ–≥–æ –ø—Ä–∏—Ç–æ–∫–∞          | –ú–æ—â–Ω–æ—Å—Ç—å –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—Ç–æ–∫–∞, —Ç–µ–∫—É—â–µ–≥–æ —á–µ—Ä–µ–∑ –ø—Ä–∞–≤—É—é —Å—Ç–æ—Ä–æ–Ω—É –ø–æ—Ä—Ç–∞–ª–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ | 5.304 - 645.249       |
| –ü–ª–∞–º—è —Å—Ç–∏—Ö–∏–π                   | –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –º–∞–≥–∏—á–µ—Å–∫–æ–π —ç–Ω–µ—Ä–≥–∏–∏, –∏—Å—Ö–æ–¥—è—â–µ–π –∏–∑ –≤—ã—Å–æ–∫–æ–≥–æ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–æ—Ä—Ç–∞–ª–∞, –≤ –≥—Ä–∞–¥—É—Å–∞—Ö –¶–µ–ª—å—Å–∏—è | 442.364 - 1115.797    |
| –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞       | –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–∑–¥—É—Ö–∞, –≤—Ö–æ–¥—è—â–µ–≥–æ –≤ –º–∞–≥–∏—á–µ—Å–∫–∏–π —É—Å–∫–æ—Ä–∏—Ç–µ–ª—å –ø–æ—Ä—Ç–∞–ª–∞, –≤ –≥—Ä–∞–¥—É—Å–∞—Ö –¶–µ–ª—å—Å–∏—è | 736.0                  |
| –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞      | –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–∑–¥—É—Ö–∞, –≤—ã—Ö–æ–¥—è—â–µ–≥–æ –∏–∑ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —É—Å–∫–æ—Ä–∏—Ç–µ–ª—è –ø–æ—Ä—Ç–∞–ª–∞, –≤ –≥—Ä–∞–¥—É—Å–∞—Ö –¶–µ–ª—å—Å–∏—è | 550.985 - 787.827                      |
| –ü—Ä–∏—Ç–æ–∫ –¥–∞–≤–ª–µ–Ω–∏—è –í—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞ | –î–∞–≤–ª–µ–Ω–∏–µ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –Ω–∞ –≤—ã—Ö–æ–¥–µ –∏–∑ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤—ã—Å–æ–∫–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è | 1.093 - 4.560         |
| –î–∞–≤–ª–µ–Ω–∏–µ –≤–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞         | –î–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞, –≤—Ö–æ–¥—è—â–µ–≥–æ –≤ –º–∞–≥–∏—á–µ—Å–∫–∏–π —É—Å–∫–æ—Ä–∏—Ç–µ–ª—å                        | 1.394603                      |
| –î–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞ –ò—Å—Ç–æ–∫–∞        | –î–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞, –∏—Å—Ö–æ–¥—è—â–µ–≥–æ –∏–∑ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —É—Å–∫–æ—Ä–∏—Ç–µ–ª—è                      | 5.828 - 23.140        |
| –î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä                 | –î–∞–≤–ª–µ–Ω–∏–µ –¥—Ä–µ–≤–Ω–µ–π –º–∞–≥–∏—á–µ—Å–∫–æ–π —ç–Ω–µ—Ä–≥–∏–∏, –ø–æ–∫–∏–¥–∞—é—â–µ–π –ø–æ—Ä—Ç–∞–ª –≤ –≤–∏–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ | 1.019 - 1.049                      |
| –ü–µ—á–∞—Ç—å –ß–∞—Ä–æ–¥–µ—è               | –ü–∞—Ä–∞–º–µ—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–≥–∏—á–µ—Å–∫–∏–º –≤–ø—Ä—ã—Å–∫–æ–º –≤ —Å–µ—Ä–¥—Ü–µ –ø–æ—Ä—Ç–∞–ª–∞, –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã–π –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö | 0.000 - 92.556        |
| –≠–º—É–ª—å—Å–∏—è –ò—Å—Ç–æ–∫–∞               | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —Ç–æ–ø–ª–∏–≤–∞, –ø–æ–¥–ø–∏—Ç—ã–≤–∞—é—â–µ–≥–æ –ø–æ—Ä—Ç–∞–ª                      | 0.068 - 1.832         |
| –î—ã—Ö–∞–Ω–∏–µ –ò—Å—Ç–æ–∫–∞                | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç, –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∏–π —Å—Ç–µ–ø–µ–Ω—å —É–≥–∞—Å–∞–Ω–∏—è –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —É—Å–∫–æ—Ä–∏—Ç–µ–ª—è           | 0.950 - 1.000         |
| –ì–∞—Ä–º–æ–Ω–∏—è –ë–µ—Å—Å–º–µ—Ä—Ç–∏—è            | –¶–µ–ª–µ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, —É–∫–∞–∑—ã–≤–∞—é—â–∞—è –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞ –ø–æ—Ä—Ç–∞–ª–∞ –∏ –µ–≥–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, —Ç—Ä–µ–±—É—é—â–∞—è –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Å–ª—É—á–∞–µ —Å–Ω–∏–∂–µ–Ω–∏—è | 0.975 - 1.000         |
| –¢–∏–ø –í–µ–∫—Ç–æ—Ä–∞ –ú–æ—â–∏              | –ú–µ—Ç–∫–∞ —Ç–∏–ø–∞ –ø–æ–∑–∏—Ü–∏–∏ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞                                  | –°–ª–∞–±—ã–π, –ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ, –í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ, –°–∏–ª—å–Ω—ã–π                      |
| –ù–æ–º–µ—Ä –ø–æ–º–µ—Ç–∫–∏                 | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –∑–∞–ø–∏—Å–∏ –æ —Ä–∞–±–æ—Ç–µ –ø–æ—Ä—Ç–∞–ª–∞ –≤ –±–ª–æ–∫–Ω–æ—Ç–µ                        | 0 - 11933     |

–û–ø—Ä–µ–¥–µ–ª–∏–º —Ñ–æ—Ä–º—É–ª—ã, –ø—Ä–∏–º–µ–Ω–∏–º—ã–µ –≤ –¥–∞–Ω–Ω–æ–π –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏

<b>–°–æ–≤–æ–∫—É–ø–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–æ–≤</b>

$f_{sum} = f_{left} + f_{right} + f_c$

–ì–¥–µ

$f_{sum}$ - –°–æ–≤–æ–∫—É–ø–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–æ–≤

$f_{left}$ - –°–∏–ª–∞ –ª–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞

$f_{right}$ - –°–∏–ª–∞ –ø—Ä–∞–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞

$f_c$ - –ü—Ä–∏—Ç–æ–∫ —Å–∏–ª—ã –ø–æ—Ç–æ–∫–æ–≤

<br>

<b>–û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞</b>

$k_{sum} = r * f_c$

–ì–¥–µ

$k_{sum}$ - –û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞

$r$ - –†–∏—Ç–º –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞

$f_c$ - –ü—Ä–∏—Ç–æ–∫ —Å–∏–ª—ã –ø–æ—Ç–æ–∫–æ–≤


<br>

<b>–û–±—â–µ–µ –¥–∞–≤–ª–µ–Ω–∏–µ</b>

$P_{sum} = P_{out} + \Delta P$

–ì–¥–µ

$P_{sum}$ - –û–±—â–µ–µ –¥–∞–≤–ª–µ–Ω–∏–µ

$P_{out}$ - –î–∞–≤–ª–µ–Ω–∏–µ –í—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞

$\Delta P$ - –ü—Ä–∏—Ç–æ–∫ –¥–∞–≤–ª–µ–Ω–∏—è –í—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞

<br>

<b>–ú–∞–≥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</b>

$V = \frac{v}{e}$

–ì–¥–µ

$V$ - –ú–∞–≥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

$v$ - –°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª

$e$ - –≠–º—É–ª—å—Å–∏—è –∏—Å—Ç–æ–∫–∞


<br>

<b>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —è–¥—Ä–∞</b>

$E_k = \frac{k_{sum}}{e}$

–ì–¥–µ

$E_k$ - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —è–¥—Ä–∞

$k_{sum}$ - –û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞

$e$ - –≠–º—É–ª—å—Å–∏—è –∏—Å—Ç–æ–∫–∞


<br>

<b>–°—Ç–µ–ø–µ–Ω—å –∏–∑–Ω–æ—Å–∞ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤</b>

$U = \frac{b}{H}$

–ì–¥–µ

$U$ - –°—Ç–µ–ø–µ–Ω—å –∏–∑–Ω–æ—Å–∞ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

$b$ - –î—ã—Ö–∞–Ω–∏–µ –∏—Å—Ç–æ–∫–∞

$H$ - –ì–∞—Ä–º–æ–Ω–∏—è –±–µ—Å—Å–º–µ—Ä—Ç–∏—è

<p style="color: red;"><b>–§–æ—Ä–º—É–ª—É –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏, —Ç.–∫. –æ–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–µ–ª–µ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é!</b></p>
<br>

<b>–†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –º–∞–≥–∏–∏</b>

$\Delta S = |b - H|$

–ì–¥–µ

$\Delta S$ - –°—Ç–µ–ø–µ–Ω—å –∏–∑–Ω–æ—Å–∞ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

$b$ - –î—ã—Ö–∞–Ω–∏–µ –∏—Å—Ç–æ–∫–∞

$H$ - –ì–∞—Ä–º–æ–Ω–∏—è –±–µ—Å—Å–º–µ—Ä—Ç–∏—è

<p style="color: red;"><b>–§–æ—Ä–º—É–ª—É –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏, —Ç.–∫. –æ–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–µ–ª–µ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é!</b></p>
<br>

<b>–ë–∞–ª–∞–Ω—Å —É–≥–∞—Å–∞–Ω–∏—è</b>

$B = \frac{\Delta S}{v}$

–ì–¥–µ

$\Delta S$ - –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –º–∞–≥–∏–∏

$B$ - –ë–∞–ª–∞–Ω—Å —É–≥–∞—Å–∞–Ω–∏—è

$v$ - –°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª

<p style="color: red;"><b>–§–æ—Ä–º—É–ª—É –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏, —Ç.–∫. –æ–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–µ–ª–µ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é!</b></p>

<br>

<br>

–†–∞–±–æ—Ç–∞ –≤–µ–ª–∞—Å—å –Ω–∞ `Python 3.10.11`
"""

!python --version

"""–ë—ã–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

* pandas
* numpy
* scikit-learn
* matplotlib
* seaborn
* pyod
* optuna

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
"""

import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from matplotlib import pyplot as plt
import seaborn as sns

"""–ó–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π seed"""

seed = 42
np.random.seed(seed)

"""# 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö <a class="anchor" id="chapter1"></a> [‚Üë](#toc)

## 1.1. –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö <a class="anchor" id="section_1_1"></a> [‚Üë](#toc)
"""

import pandas as pd

data = pd.read_csv('D:/PythonWork/OldZmiy/NLPWork/data/portal_data.csv', encoding='Windows-1251', delimiter='|')
data

"""## 1.2. –ü–µ—Ä–≤–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö <a class="anchor" id="section_1_2"></a> [‚Üë](#toc)

–í –¥–∞–Ω–Ω—ã—Ö –∏–º–µ—é—Ç—Å—è –ø—Ä–æ–ø—É—Å–∫–∏ (`-`, `–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ`). –ü—Ä–∏–≤–µ–¥–µ–º –∏—Ö –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É `None`
"""

data.replace('-', None, inplace=True)
data.replace('–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ', None, inplace=True)
data

"""–ü—Ä–æ–≤–µ—Ä–∏–º —Ç–∏–ø—ã –ø–æ–ª–µ–π –¥–∞—Ç–∞—Å–µ—Ç–∞"""

data.info()

"""`–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª`, `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞`, `–î–∞–≤–ª–µ–Ω–∏–µ –≤–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞`, `–î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–º—É —Ç–∏–ø—É"""

cols_to_float = ['–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª', '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞', '–î–∞–≤–ª–µ–Ω–∏–µ –≤–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞', '–î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä']

for col in cols_to_float:
    data[col] = data[col].astype(float)

data.info()

"""–ú–æ–∂–Ω–æ –æ—Ç–±—Ä–æ—Å–∏—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏:
* `–ù–æ–º–µ—Ä –ø–æ–º–µ—Ç–∫–∏`, —Ç.–∫. –ø—Ä–∏–∑–Ω–∞–∫ –æ—Ç—Ä–∞–∂–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏
* `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞` –∏ `–î–∞–≤–ª–µ–Ω–∏–µ –≤–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞`, —Ç.–∫. –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã
"""

cols_to_del = ['–ù–æ–º–µ—Ä –ø–æ–º–µ—Ç–∫–∏', '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞', '–î–∞–≤–ª–µ–Ω–∏–µ –≤–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞']

data = data.drop(cols_to_del, axis=1)

data

"""## 1.3. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∫–∏ –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏ <a class="anchor" id="section_1_3"></a> [‚Üë](#toc)

–†–∞–∑–¥–µ–ª–∏–º –≤—ã–±–æ—Ä–∫—É –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ—Ç–Ω–æ—à–µ–Ω–∏–∏: train = 80%, test = 20%, —Ç.–∫. –¥–∞—Ç–∞—Å–µ—Ç –∏–º–µ–µ—Ç –±–æ–ª—å—à–æ–π –æ–±—ä–µ–º, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫—É —Ç–∞–∫–∂–µ –∫—Ä—É–ø–Ω–æ–π
"""

y = data['–ì–∞—Ä–º–æ–Ω–∏—è –ë–µ—Å—Å–º–µ—Ä—Ç–∏—è']
X = data.drop(['–ì–∞—Ä–º–æ–Ω–∏—è –ë–µ—Å—Å–º–µ—Ä—Ç–∏—è'], axis=1)

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=seed)
X_train

"""## 1.4. –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ <a class="anchor" id="section_1_4"></a> [‚Üë](#toc)

`–¢–∏–ø –í–µ–∫—Ç–æ—Ä–∞ –ú–æ—â–∏` —è–≤–ª—è–µ—Ç—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–º –ø—Ä–∏–∑–Ω–∞–∫–æ–º.

–ó–∞–∫–æ–¥–∏—Ä—É–µ–º –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

- `–°–ª–∞–±—ã–π` -> 0
- `–ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ` -> 1
- `–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ` -> 2
- `–°–∏–ª—å–Ω—ã–π` -> 3
"""

from sklearn.preprocessing import OrdinalEncoder

categories = [['–°–ª–∞–±—ã–π', '–ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ', '–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ', '–°–∏–ª—å–Ω—ã–π']]
enc = OrdinalEncoder(categories=categories)

X_train['–¢–∏–ø –í–µ–∫—Ç–æ—Ä–∞ –ú–æ—â–∏'] = enc.fit_transform(X_train[['–¢–∏–ø –í–µ–∫—Ç–æ—Ä–∞ –ú–æ—â–∏']]).astype(int)
X_test['–¢–∏–ø –í–µ–∫—Ç–æ—Ä–∞ –ú–æ—â–∏'] = enc.fit_transform(X_test[['–¢–∏–ø –í–µ–∫—Ç–æ—Ä–∞ –ú–æ—â–∏']]).astype(int)

X_train['–¢–∏–ø –í–µ–∫—Ç–æ—Ä–∞ –ú–æ—â–∏']

"""## 1.5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤) <a class="anchor" id="section_1_5"></a> [‚Üë](#toc)

–£–∑–Ω–∞–µ–º, –≤ –∫–∞–∫–∏—Ö —Å—Ç–æ–ª–±—Ü–∞—Ö –µ—Å—Ç—å –ø—Ä–æ–ø—É—Å–∫–∏
"""

data.isna().sum()

"""–ü—Ä–æ–ø—É—Å–∫–∏ –∏–º–µ—é—Ç—Å—è –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö `–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª`, `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞`, `–î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä`"""

cols = ['–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª', '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞', '–î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä']

"""### –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤

–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–ø—É—Å–∫–∏ –º–æ–∂–Ω–æ:

- <b>–°—Ä–µ–¥–Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º</b>
- <b>–ú–µ–¥–∏–∞–Ω–æ–π</b>
- <b>–ú–æ–¥–æ–π</b>

–§—É–Ω–∫—Ü–∏—è, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—â–∞—è KL-–¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—é –º–µ–∂–¥—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏
"""

from scipy.stats import entropy

def calculate_kl_divergence(dataset_before, dataset_after):
    kl_results = []

    for column in dataset_before.columns:
        before_data = dataset_before[column]
        after_data = dataset_after[column]

        bins = np.histogram_bin_edges(np.concatenate([before_data.dropna(), after_data.dropna()]), bins='auto')
        hist_before, _ = np.histogram(before_data.dropna(), bins=bins, density=True)
        hist_after, _ = np.histogram(after_data.dropna(), bins=bins, density=True)

        min_len = min(len(hist_before), len(hist_after))
        hist_before = hist_before[:min_len]
        hist_after = hist_after[:min_len]

        try:
            kl_div = entropy(hist_before, hist_after)
            kl_results.append((column, kl_div))
        except ValueError:
            print(f"–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –ø–æ—Å—á–∏—Ç–∞–ª—å –¥–ª—è {column}: —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω—É–ª–µ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏")

    return kl_results

"""–§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è"""

def compare_distributions(data_before, data_after):
    plt.figure(figsize=(3, 3))

    for c in cols:
        data_before.hist(c, bins=10)
        data_after.hist(c, bins=10)

        plt.title(c)
        plt.xlabel('–ó–Ω–∞—á–µ–Ω–∏—è')
        plt.ylabel('–ü–ª–æ—Ç–Ω–æ—Å—Ç—å')
        plt.legend()
        plt.grid(True)
        plt.show()

"""##### –î–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ"""

mean_fill_data = X_train.copy()

mean_portal_speed = X_train['–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª'].mean()
mean_fill_data.fillna({'–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª': mean_portal_speed}, inplace=True)

mean_spring_t = X_train['–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞'].mean()
mean_fill_data.fillna({'–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞': mean_spring_t}, inplace=True)

mean_ancient_wind = X_train['–î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä'].mean()
mean_fill_data.fillna({'–î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä': mean_ancient_wind}, inplace=True)

mean_kl_values = calculate_kl_divergence(X_train[cols], mean_fill_data[cols])
for col, div in mean_kl_values:
    print(f"'{col}' –∏–º–µ–µ—Ç KL-–¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—é: {div:.4f}")

compare_distributions(X_train[cols], mean_fill_data[cols])

"""##### –î–ª—è –º–µ–¥–∏–∞–Ω—ã"""

med_fill_data = X_train.copy()

med_portal_speed = X_train['–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª'].median()
med_fill_data.fillna({'–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª': med_portal_speed}, inplace=True)

med_spring_t = X_train['–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞'].median()
med_fill_data.fillna({'–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞': med_spring_t}, inplace=True)

med_ancient_wind = X_train['–î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä'].median()
med_fill_data.fillna({'–î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä': med_ancient_wind}, inplace=True)

med_kl_values = calculate_kl_divergence(X_train[cols], med_fill_data[cols])
for col, div in med_kl_values:
    print(f"'{col}' –∏–º–µ–µ—Ç KL-–¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—é: {div:.4f}")

compare_distributions(X_train[cols], med_fill_data[cols])

"""##### –î–ª—è –º–æ–¥—ã"""

mod_fill_data = X_train.copy()

mod_portal_speed = X_train.dropna()['–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª'].mode().mean()
mod_fill_data.fillna({'–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª': mod_portal_speed}, inplace=True)

mod_spring_t = X_train.dropna()['–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞'].mode().mean()
mod_fill_data.fillna({'–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞': mod_spring_t}, inplace=True)

mod_ancient_wind = X_train.dropna()['–î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä'].mode().mean()
mod_fill_data.fillna({'–î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä': mod_ancient_wind}, inplace=True)

mod_kl_values = calculate_kl_divergence(X_train[cols], mod_fill_data[cols])
for col, div in mod_kl_values:
    print(f"'{col}' –∏–º–µ–µ—Ç KL-–¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—é: {div:.4f}")

compare_distributions(X_train[cols], mod_fill_data[cols])

"""–°—Ä–∞–≤–Ω–∏–º –º–µ–∂–¥—É —Å–æ–±–æ–π –∑–Ω–∞—á–µ–Ω–∏—è k-–¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏–∏ —Ä–∞–∑–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤."""

print('–î–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ:')
mean_kl_values = calculate_kl_divergence(X_train[cols], mean_fill_data[cols])
for col, div in mean_kl_values:
    print(f"'{col}' –∏–º–µ–µ—Ç KL-–¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—é: {div:.4f}")

print('\n–î–ª—è –º–µ–¥–∏–∞–Ω—ã:')
mean_kl_values = calculate_kl_divergence(X_train[cols], med_fill_data[cols])
for col, div in mean_kl_values:
    print(f"'{col}' –∏–º–µ–µ—Ç KL-–¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—é: {div:.4f}")

print('\n–î–ª—è –º–æ–¥—ã:')
mean_kl_values = calculate_kl_divergence(X_train[cols], mod_fill_data[cols])
for col, div in mean_kl_values:
    print(f"'{col}' –∏–º–µ–µ—Ç KL-–¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—é: {div:.4f}")

"""`–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª` –∏ `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞` –∑–∞–ø–æ–ª–Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º <b>–º–µ–¥–∏–∞–Ω—ã</b>. –ê `–î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä` - –∑–Ω–∞—á–µ–Ω–∏–µ–º <b>–º–æ–¥—ã</b>"""

X_train_stat, X_test_stat = X_train.copy(), X_test.copy()

replacements = {
    '–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª': med_portal_speed,
    '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞': med_spring_t,
    '–î—Ä–µ–≤–Ω–∏–π –í–µ—Ç–µ—Ä': mod_ancient_wind
}

X_train_stat.fillna(replacements, inplace=True)
X_test_stat.fillna(replacements, inplace=True)

X_train_stat

"""### –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é –º–∞—à–∏–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤

–í–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è `IterativeImputer`
"""

from sklearn.experimental import enable_iterative_imputer
from sklearn.impute import IterativeImputer

columns = X_train.columns

imputer_mice = IterativeImputer(max_iter=10, random_state=0)
X_train_iter = imputer_mice.fit_transform(X_train)
X_test_iter = imputer_mice.transform(X_test)

X_train_iter = pd.DataFrame(X_train_iter, columns=columns)
X_test_iter = pd.DataFrame(X_test_iter, columns=columns)

X_train_iter

"""–°—Ä–∞–≤–Ω–∏–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ –∏ –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤"""

compare_distributions(X_train[cols], X_train_iter[cols])

"""–í–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —Ç–∞–∫–∂–µ `KNNImputer`"""

from sklearn.impute import KNNImputer
import pandas as pd

knn_imputer = KNNImputer(n_neighbors=5)
X_train_knn = knn_imputer.fit_transform(X_train)
X_test_knn = knn_imputer.transform(X_test)

X_train_knn = pd.DataFrame(X_train_knn, columns=columns, index=X_train.index)
X_test_knn = pd.DataFrame(X_test_knn, columns=columns, index=X_test.index)

y_train_aligned = y_train.loc[X_train_knn.index]
y_test_aligned = y_test.loc[X_test_knn.index]

"""–°—Ä–∞–≤–Ω–∏–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–æ –∏ –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤"""

compare_distributions(X_train[cols], X_train_knn[cols])

"""## 1.6. –î–µ—Ç–µ–∫—Ü–∏—è –≤—ã–±—Ä–æ—Å–æ–≤ –∏ –∞–Ω–æ–º–∞–ª–∏–π –≤ –¥–∞–Ω–Ω—ã—Ö <a class="anchor" id="section_1_6"></a> [‚Üë](#toc)

–§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ç—Ä–µ—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º
"""

from matplotlib.axes._axes import Axes


def draw_sns(df, visualization_function, figsize=(20, 20), **kwargs):
    n_col = 3
    n = len(df.columns)
    n_row = int(np.ceil(n / n_col))

    _, ax = plt.subplots(n_row, n_col, figsize=figsize)

    columns = df.columns

    for i in range(n_row):
        for j in range(n_col):
            k = i * n_col + j
            if k == n:
                break
            column = columns[k]
            x = df[column]
            visualization_function(x, ax=ax[i, j], **kwargs)

"""–ü–æ—Å—Ç—Ä–æ–∏–º –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤"""

draw_sns(X_train_knn, visualization_function=sns.histplot)

"""–ó–∞–º–µ—Ç–∏–º, —á—Ç–æ –≤—ã–±—Ä–æ—Å—ã –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞—Ö —è—Ä–∫–æ –Ω–µ –≤—ã—Ä–∞–∂–µ–Ω—ã

### –ö–≤–∞—Ä—Ç–∏–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

–í–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –¥–∏–∞–≥—Ä–∞–º–º–æ–π "–Ø—â–∏–∫ —Å —É—Å–∞–º–∏" –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—ã–±—Ä–æ—Å–æ–≤
"""

draw_sns(X_train_knn, sns.boxplot, figsize=(20, 25))

"""–ü–æ –≥—Ä–∞—Ñ–∏–∫–∞–º –≤–∏–¥–Ω–æ, —á—Ç–æ –≤—ã–±—Ä–æ—Å—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –ø—Ä–∏–∑–Ω–∞–∫–µ `–ü–µ—á–∞—Ç—å —á–∞—Ä–æ–¥–µ—è`

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ IQR

–§—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –ª–µ–≤—É—é –∏ –ø—Ä–∞–≤—É—é –≥—Ä–∞–Ω–∏—Ü—ã IQR
"""

def calc_bounds(x):
    q1, q3 = np.percentile(x, [25, 75])
    iqr = q3 - q1
    lower_bound = q1 - 1.5 * iqr
    upper_bound = q3 + 1.5 * iqr
    return lower_bound, upper_bound

"""–§—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –±—É–ª–µ–≤ –º–∞—Å—Å–∏–≤, —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ `False` - –≤—ã–±—Ä–æ—Å–æ–≤ –Ω–µ—Ç, `True` - –≤—ã–±—Ä–æ—Å—ã –µ—Å—Ç—å"""

def check_feature_outliers_iqr(x: pd.Series):
    lower_bound, upper_bound = calc_bounds(x)
    return ((x < lower_bound) | (x > upper_bound)).values

"""### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ Robust Z-Score"""

def check_feature_outliers_z_score(data, threshold=3.3):
    median = np.median(data)
    mad = np.median(np.abs(data - median))

    normalized_mad = 1.4826 * mad # –∏–∑ —Å–≤–æ–π—Å—Ç–≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

    robust_z_scores = (data - median) / normalized_mad

    return (np.abs(robust_z_scores) > threshold).values

"""### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—ã–±—Ä–æ—Å—ã

–§—É–Ω–∫—Ü–∏—è, –ø—Ä–æ–≤–µ—Ä—è—é—â–∞—è —Å—Ç–æ–ª–±—Ü—ã –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤—ã–±—Ä–æ—Å–æ–≤
"""

def check_dataset_outliers(df, outliers_method, **kwargs):
    outliers_flags = [
        outliers_method(df[column], **kwargs) for column in df.columns
    ]
    return np.any(np.array(outliers_flags), axis=0)

"""–û–ø—Ä–µ–¥–µ–ª–∏–º —Å—Ç—Ä–æ–∫–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –≤—ã–±—Ä–æ—Å—ã"""

outliers_objects_iqr = X_train_knn.loc[check_dataset_outliers(X_train_knn, check_feature_outliers_iqr)]
outliers_objects_iqr

outliers_objects_z_score = X_train_knn.loc[check_dataset_outliers(X_train_knn, check_feature_outliers_z_score)]
outliers_objects_z_score

"""### –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –≤—ã–±—Ä–æ—Å–∞–º–∏"""

outliers_objects = np.intersect1d(
    outliers_objects_iqr.index,
    outliers_objects_z_score.index
)
outliers_objects

outliers_objects.shape

"""–ü–æ–ª—É—á–∞–µ–º 186 –∑–∞–ø–∏—Å–µ–π-–≤—ã–±—Ä–æ—Å–æ–≤

–û—á–∏—Å—Ç–∏–º –¥–∞—Ç–∞—Å–µ—Ç –æ—Ç –≤—ã–±—Ä–æ—Å–æ–≤
"""

X_train_pure = X_train_knn.drop(outliers_objects)
y_train_pure = y_train.drop(outliers_objects)
X_train_pure
y_train_pure

"""## –ü–æ–∏—Å–∫ –∞–Ω–æ–º–∞–ª–∏–π –≤ –¥–∞–Ω–Ω—ã—Ö

–§—É–Ω–∫—Ü–∏—è –ø–æ–º–µ—Ç–∫–∏ –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
"""

def draw_anomaly(X_2d, anomaly_mask):
    plt.scatter(X_2d[:, 0], X_2d[:, 1])
    plt.scatter(X_2d[anomaly_mask, 0], X_2d[anomaly_mask, 1], c="red", marker='x')

"""–§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –∫—Ä—É–≥–æ–≤–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã"""

def draw_anomaly_pie(anomaly_mask):
    _, counts = np.unique(anomaly_mask, return_counts=True)

    plt.pie(counts, labels=counts, autopct='%1.0f%%');
    plt.legend([
        '–ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã', '–ê–Ω–æ–º–∞–ª–∏–∏'
    ], loc='lower right');

"""–ü–æ–Ω–∏–∑–∏–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–æ –¥–≤—É–º–µ—Ä–Ω–æ–≥–æ"""

from umap.umap_ import UMAP

X_2d = UMAP().fit_transform(X_train_pure)

"""### –ü–æ–∏—Å–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ IsolationForest"""

from pyod.models.iforest import IForest


isf = IForest().fit(X_train_pure)
isf_anomaly = isf.predict(X_train_pure)

draw_anomaly_pie(isf_anomaly)

"""–î–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ—Å—á–∏—Ç–∞–ª 936 –æ–±—ä–µ–∫—Ç–æ–≤ –∞–Ω–æ–º–∞–ª—å–Ω—ã–º–∏."""

draw_anomaly(X_2d, isf_anomaly.astype(bool))

"""–ó–∞–º–µ—Ç–∏–º, —á—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º –æ—Ç–º–µ—Ç–∏–ª –¥–≤–∞ "–æ—Å—Ç—Ä–æ–≤–∞" —Å–ª–µ–≤–∞ —Å–Ω–∏–∑—É

### –ü–æ–∏—Å–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ OCSVM
"""

from pyod.models.ocsvm import OCSVM


ocsvm = OCSVM().fit(X_train_pure)
ocsvm_anomaly = ocsvm.predict(X_train_pure)

draw_anomaly_pie(ocsvm_anomaly)

"""–î–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ—Å—á–∏—Ç–∞–ª —Ç–∞–∫–∂–µ 936 –æ–±—ä–µ–∫—Ç–æ–≤ –∞–Ω–æ–º–∞–ª—å–Ω—ã–º–∏."""

draw_anomaly(X_2d, ocsvm_anomaly.astype(bool))

"""–ó–∞–º–µ—Ç–∏–º, —á—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º –æ—Ç–º–µ—Ç–∏–ª –¥–≤–∞ "–¥–ª–∏–Ω–Ω—ã—Ö –æ—Å—Ç—Ä–æ–≤–∞" —Å–Ω–∏–∑—É

### –ü–æ–∏—Å–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–ª–æ—Ç–Ω–æ—Å—Ç–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
"""

from pyod.models.lof import LOF

lf = LOF().fit(X_train_pure)
lf_anomaly = lf.predict(X_train_pure)

draw_anomaly_pie(lf_anomaly)

"""–î–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ—Å—á–∏—Ç–∞–ª 802 –æ–±—ä–µ–∫—Ç–∞ –∞–Ω–æ–º–∞–ª—å–Ω—ã–º–∏."""

draw_anomaly(X_2d, lf_anomaly.astype(bool))

"""–ó–∞–º–µ—Ç–∏–º, —á—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º –æ–±–≤–µ–ª –∫–∞–∂–¥—ã–π –∏–∑ "–æ—Å—Ç—Ä–æ–≤–æ–≤"

## –£–¥–∞–ª–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

–í–æ–∑—å–º–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ –∞–Ω–æ–º–∞–ª–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–±—Ä–∞–ª–∏ –≤—Å–µ —Ç—Ä–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
"""

anomalies = np.all(np.array([
    isf_anomaly,
    ocsvm_anomaly,
    lf_anomaly
]), axis=0)
anomalies

draw_anomaly_pie(anomalies)

"""–í—ã—à–ª–æ 26 –∞–Ω–æ–º–∞–ª–∏–π"""

draw_anomaly(X_2d, anomalies)

anomaly_index = X_train_pure.loc[anomalies].index
anomaly_index

X_train_pure = X_train_pure.drop(anomaly_index)
y_train_pure = y_train_pure.drop(anomaly_index)
X_train_pure.shape
y_train_pure

X_test_pure = X_test_knn
y_test_pure = y_test_aligned

"""## 1.7. –ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ —Ä–∞–∑–¥–µ–ª–∞ 1 <a class="anchor" id="section_1_7"></a> [‚Üë](#toc)
<!-- –ê —Ç–∞–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö –æ–±—ã—á–Ω–æ –ø–æ–¥—ã—Ç–æ–∂–∏–≤–∞–µ—Ç—Å—è –≤—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –¥–µ–ª–∞–ª–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ -->

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø—Ä–æ–ø—É—Å–∫–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –±—ã–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã, –∞ –≤—ã–±—Ä–æ—Å—ã —É–¥–∞–ª–µ–Ω—ã. –î–∞—Ç–∞—Å–µ—Ç –±—ã–ª –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã.

# 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ <a class="anchor" id="chapter2"></a> [‚Üë](#toc)

## 2.1. –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—Ö–æ–¥–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (–ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–µ–ø–ª–æ–≤—ã—Ö –∫–∞—Ä—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏) <a class="anchor" id="section_2_1"></a> [‚Üë](#toc)

–ü–æ—Å—Ç—Ä–æ–∏–º —Ç–µ–ø–ª–æ–≤—É—é –∫–∞—Ä—Ç—É –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
"""

corr = X_train_pure.drop(['–¢–∏–ø –í–µ–∫—Ç–æ—Ä–∞ –ú–æ—â–∏'], axis=1).corr()

plt.figure(figsize=(12, 8))
sns.heatmap(corr, annot=True, cmap='coolwarm')
plt.show()

"""## 2.2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –º—É–ª—å—Ç–∏–∫–æ–ª–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç–∏ –≤ –¥–∞–Ω–Ω—ã—Ö <a class="anchor" id="section_2_2"></a> [‚Üë](#toc)

–í—Å–ø–æ–º–Ω–∏–º –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –≤ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ñ–æ—Ä–º—É–ª—ã –∏ —É—Å—Ç—Ä–∞–Ω–∏–º —Å –∏—Ö –ø–æ–º–æ—â—å—é –ø—Ä–æ–±–ª–µ–º—É –º—É–ª—å—Ç–∏–∫–æ–ª–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç–∏ –≤ –¥–∞–Ω–Ω—ã—Ö

<b>–°–æ–≤–æ–∫—É–ø–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–æ–≤</b>

$f_{sum} = f_{left} + f_{right} + f_c$

–ì–¥–µ

$f_{sum}$ - –°–æ–≤–æ–∫—É–ø–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–æ–≤

$f_{left}$ - –°–∏–ª–∞ –ª–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞

$f_{right}$ - –°–∏–ª–∞ –ø—Ä–∞–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞

$f_c$ - –ü—Ä–∏—Ç–æ–∫ —Å–∏–ª—ã –ø–æ—Ç–æ–∫–æ–≤

<br>
"""

X_train_pure['–°–æ–≤–æ–∫—É–ø–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–æ–≤'] = X_train_pure['–°–∏–ª–∞ –õ–µ–≤–æ–≥–æ –ü–æ—Ç–æ–∫–∞'] + \
                                                X_train_pure['–°–∏–ª–∞ –ü—Ä–∞–≤–æ–≥–æ –ü–æ—Ç–æ–∫–∞'] + \
                                                    X_train_pure['–ü—Ä–∏—Ç–æ–∫ –°–∏–ª—ã –ü–æ—Ç–æ–∫–∞']

X_test_pure['–°–æ–≤–æ–∫—É–ø–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–æ–≤'] = X_test_pure['–°–∏–ª–∞ –õ–µ–≤–æ–≥–æ –ü–æ—Ç–æ–∫–∞'] + \
                                                X_test_pure['–°–∏–ª–∞ –ü—Ä–∞–≤–æ–≥–æ –ü–æ—Ç–æ–∫–∞'] + \
                                                    X_test_pure['–ü—Ä–∏—Ç–æ–∫ –°–∏–ª—ã –ü–æ—Ç–æ–∫–∞']

X_train_pure['–°–æ–≤–æ–∫—É–ø–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–æ–≤']

"""<b>–û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞</b>

$k_{sum} = r * f_c$

–ì–¥–µ

$k_{sum}$ - –û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞

$r$ - –†–∏—Ç–º –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞

$f_c$ - –ü—Ä–∏—Ç–æ–∫ —Å–∏–ª—ã –ø–æ—Ç–æ–∫–æ–≤


<br>
"""

X_train_pure['–û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞'] = X_train_pure['–†–∏—Ç–º –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞'] * X_train_pure['–ü—Ä–∏—Ç–æ–∫ –°–∏–ª—ã –ü–æ—Ç–æ–∫–∞']

X_test_pure['–û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞'] = X_test_pure['–†–∏—Ç–º –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞'] * X_test_pure['–ü—Ä–∏—Ç–æ–∫ –°–∏–ª—ã –ü–æ—Ç–æ–∫–∞']

X_train_pure['–û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞']

"""<b>–û–±—â–µ–µ –¥–∞–≤–ª–µ–Ω–∏–µ</b>

$P_{sum} = P_{out} + \Delta P$

–ì–¥–µ

$P_{sum}$ - –û–±—â–µ–µ –¥–∞–≤–ª–µ–Ω–∏–µ

$P_{out}$ - –î–∞–≤–ª–µ–Ω–∏–µ –í—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞

$\Delta P$ - –ü—Ä–∏—Ç–æ–∫ –¥–∞–≤–ª–µ–Ω–∏—è –í—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞

<br>
"""

X_train_pure['–û–±—â–µ–µ –î–∞–≤–ª–µ–Ω–∏–µ'] = X_train_pure['–î–∞–≤–ª–µ–Ω–∏–µ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞'] + X_train_pure['–ü—Ä–∏—Ç–æ–∫ –¥–∞–≤–ª–µ–Ω–∏—è –í—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞']

X_test_pure['–û–±—â–µ–µ –î–∞–≤–ª–µ–Ω–∏–µ'] = X_test_pure['–î–∞–≤–ª–µ–Ω–∏–µ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞'] + X_test_pure['–ü—Ä–∏—Ç–æ–∫ –¥–∞–≤–ª–µ–Ω–∏—è –í—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞']

X_train_pure['–û–±—â–µ–µ –î–∞–≤–ª–µ–Ω–∏–µ']

"""<b>–ú–∞–≥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</b>

$V = \frac{v}{e}$

–ì–¥–µ

$V$ - –ú–∞–≥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

$v$ - –°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª

$e$ - –≠–º—É–ª—å—Å–∏—è –∏—Å—Ç–æ–∫–∞


<br>
"""

X_train_pure['–ú–∞–≥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å'] = X_train_pure['–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª'] / X_train_pure['–≠–º—É–ª—å—Å–∏—è –ò—Å—Ç–æ–∫–∞']

X_test_pure['–ú–∞–≥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å'] = X_test_pure['–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª'] / X_test_pure['–≠–º—É–ª—å—Å–∏—è –ò—Å—Ç–æ–∫–∞']

X_train_pure['–ú–∞–≥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å']

"""<b>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —è–¥—Ä–∞</b>

$E_k = \frac{k_{sum}}{e}$

–ì–¥–µ

$E_k$ - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —è–¥—Ä–∞

$k_{sum}$ - –û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞

$e$ - –≠–º—É–ª—å—Å–∏—è –∏—Å—Ç–æ–∫–∞


<br>
"""

X_train_pure['–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —è–¥—Ä–∞'] = X_train_pure['–û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞'] / X_train_pure['–≠–º—É–ª—å—Å–∏—è –ò—Å—Ç–æ–∫–∞']

X_test_pure['–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —è–¥—Ä–∞'] = X_test_pure['–û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞'] / X_test_pure['–≠–º—É–ª—å—Å–∏—è –ò—Å—Ç–æ–∫–∞']

X_train_pure['–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —è–¥—Ä–∞']

"""–£–¥–∞–ª–∏–º —Å—Ç–æ–ª–±—Ü—ã:

- `–°–∏–ª–∞ –õ–µ–≤–æ–≥–æ –ü–æ—Ç–æ–∫–∞`
- `–°–∏–ª–∞ –ü—Ä–∞–≤–æ–≥–æ –ü–æ—Ç–æ–∫–∞`
- `–ü—Ä–∏—Ç–æ–∫ –°–∏–ª—ã –ø–æ—Ç–æ–∫–∞`
- `–î–∞–≤–ª–µ–Ω–∏–µ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞`
- `–ü—Ä–∏—Ç–æ–∫ –¥–∞–≤–ª–µ–Ω–∏—è –í—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞`
- `–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª`
- `–≠–º—É–ª—å—Å–∏—è –ò—Å—Ç–æ–∫–∞`
- `–û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞`
"""

X_train_new_feat = X_train_pure.drop(['–°–∏–ª–∞ –õ–µ–≤–æ–≥–æ –ü–æ—Ç–æ–∫–∞', '–°–∏–ª–∞ –ü—Ä–∞–≤–æ–≥–æ –ü–æ—Ç–æ–∫–∞', '–ü—Ä–∏—Ç–æ–∫ –°–∏–ª—ã –ü–æ—Ç–æ–∫–∞',
                                    '–î–∞–≤–ª–µ–Ω–∏–µ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞', '–ü—Ä–∏—Ç–æ–∫ –¥–∞–≤–ª–µ–Ω–∏—è –í—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞',
                                    '–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª', '–≠–º—É–ª—å—Å–∏—è –ò—Å—Ç–æ–∫–∞', '–û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞'], axis=1)

X_test_new_feat = X_test_pure.drop(['–°–∏–ª–∞ –õ–µ–≤–æ–≥–æ –ü–æ—Ç–æ–∫–∞', '–°–∏–ª–∞ –ü—Ä–∞–≤–æ–≥–æ –ü–æ—Ç–æ–∫–∞', '–ü—Ä–∏—Ç–æ–∫ –°–∏–ª—ã –ü–æ—Ç–æ–∫–∞',
                                     '–î–∞–≤–ª–µ–Ω–∏–µ –≤—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞', '–ü—Ä–∏—Ç–æ–∫ –¥–∞–≤–ª–µ–Ω–∏—è –í—ã–¥–æ—Ö–∞ –ò—Å—Ç–æ–∫–∞',
                                    '–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª', '–≠–º—É–ª—å—Å–∏—è –ò—Å—Ç–æ–∫–∞', '–û–±—â–∞—è —Å–∏–ª–∞ —è–¥—Ä–∞'], axis=1)

X_train_new_feat

"""–í—ã–≤–µ–¥–µ–º —Ç–µ–ø–ª–æ–≤—É—é –∫–∞—Ä—Ç—É –¥–ª—è –Ω–æ–≤–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞"""

corr = X_train_new_feat.drop(['–¢–∏–ø –í–µ–∫—Ç–æ—Ä–∞ –ú–æ—â–∏'], axis=1).corr()

plt.figure(figsize=(12, 8))
sns.heatmap(corr, annot=True, cmap='coolwarm')
plt.show()

"""–ü—Ä–æ–±–ª–µ–º–∞ –º—É–ª—å—Ç–∏–∫–æ–ª–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç–∏ —Ä–µ—à–µ–Ω–∞ –ª–∏—à—å —á–∞—Å—Ç–∏—á–Ω–æ

–ò—Å—Å–ª–µ–¥—É–µ–º –ø—Ä–æ–±–ª–µ–º—É –¥–∏—Å–ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
"""

X_train_new_feat.describe()

"""–ó–∞–º–µ—Ç–∏–º, —á—Ç–æ –¥–∏—Å–ø—Ä–æ–ø–æ—Ä—Ü–∏—è - –Ω–∞–ª–∏—Ü–æ! –ù–∞–ø—Ä–∏–º–µ—Ä, —É `–°–æ–≤–æ–∫—É–ø–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–æ–≤` —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ = 21810, –∞ —É `–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —è–¥—Ä–∞` - –≤—Å–µ–≥–æ –ª–∏—à—å $4 * 10^{-6}$

–ü–æ—ç—Ç–æ–º—É –±—É–¥–µ—Ç —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## 2.3. –°–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö <a class="anchor" id="section_2_3"></a> [‚Üë](#toc)

#### –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è
"""

from sklearn.preprocessing import StandardScaler

scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train_new_feat)
X_train_scaled = pd.DataFrame(X_train_scaled, columns=X_train_new_feat.columns, index=X_train_new_feat.index)
X_test_scaled = scaler.transform(X_test_new_feat)
X_test_scaled = pd.DataFrame(X_test_scaled, columns=X_test_new_feat.columns, index=X_test_new_feat.index)
X_train_scaled

"""#### MinMax-–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"""

from sklearn.preprocessing import MinMaxScaler

mmscaler = MinMaxScaler()
X_train_minmax = mmscaler.fit_transform(X_train_new_feat)
X_train_minmax = pd.DataFrame(X_train_minmax, columns=X_train_new_feat.columns, index=X_train_new_feat.index)
X_test_minmax = mmscaler.transform(X_test_new_feat)
X_test_minmax = pd.DataFrame(X_test_scaled, columns=X_test_new_feat.columns, index=X_test_new_feat.index)
X_train_minmax

"""#### –†–æ–±–∞—Å—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"""

from sklearn.preprocessing import RobustScaler

rscaler = RobustScaler()
X_train_robust = rscaler.fit_transform(X_train_new_feat)
X_train_robust = pd.DataFrame(X_train_robust, columns=X_train_new_feat.columns, index=X_train_new_feat.index)
X_test_robust = rscaler.transform(X_test_new_feat)
X_test_robust = pd.DataFrame(X_test_robust, columns=X_test_new_feat.columns, index=X_test_new_feat.index)
X_train_robust

"""## 2.4. –ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ —Ä–∞–∑–¥–µ–ª–∞ 2 <a class="anchor" id="section_2_4"></a> [‚Üë](#toc)
<!-- –ê —Ç–∞–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö –æ–±—ã—á–Ω–æ –ø–æ–¥—ã—Ç–æ–∂–∏–≤–∞–µ—Ç—Å—è –≤—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –¥–µ–ª–∞–ª–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ -->

–ë–ª–∞–≥–æ–¥–∞—Ä—è –≤–≤–µ–¥–µ–Ω–∏—é –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –≤—ã–≤–æ–¥–∏–º—ã—Ö –∏–∑ —Ñ–æ—Ä–º—É–ª –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏, –±—ã–ª–∞ —É–º–µ–Ω—å—à–µ–Ω–∞ –º—É–ª—å—Ç–∏–∫–æ–ª–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç—å –≤ –¥–∞–Ω–Ω—ã—Ö. –° –ø–æ–º–æ—â—å—é —Å–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã—Ä–æ–≤–Ω–µ–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤.

# 3. –í—ã–±–æ—Ä –º–æ–¥–µ–ª–µ–π ML –∏ –º–µ—Ç—Ä–∏–∫ <a class="anchor" id="chapter3"></a> [‚Üë](#toc)

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —Å —Ü–µ–ª–µ–≤—ã–º –ø—Ä–∏–∑–Ω–∞–∫–æ–º
"""

corr_with_target = X_train_new_feat.corrwith(y_train_pure)
heatmap = pd.DataFrame(corr_with_target).T

plt.figure(figsize=(10, 2))
sns.heatmap(heatmap, annot=True, cmap='coolwarm', vmin=-1, vmax=1, center=0, fmt='.2f')
plt.title('–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —Å —Ü–µ–ª–µ–≤—ã–º –ø—Ä–∏–∑–Ω–∞–∫–æ–º')
plt.ylabel('–ì–∞—Ä–º–æ–Ω–∏—è –ë–µ—Å—Å–º–µ—Ä—Ç–∏—è')
plt.tight_layout()
plt.show()

"""–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –∏ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ—Ç

### –ì—Ä–∞—Ñ–∏–∫–∏ —Ä–∞—Å—Å–µ—è–Ω–∏—è
"""

import matplotlib.pyplot as plt

features = X_train_pure.columns
target = y_train_pure

n_features = len(features)
n_cols = 2
n_rows = (n_features + n_cols - 1) // n_cols

fig, axes = plt.subplots(n_rows, n_cols, figsize=(12, 4*n_rows))
axes = axes.flatten()

for idx, feature in enumerate(features):
    axes[idx].scatter(X_train_pure[feature], y_train_pure, alpha=0.6)
    axes[idx].set_xlabel(feature)
    axes[idx].set_ylabel('–ì–∞—Ä–º–æ–Ω–∏—è –ë–µ—Å—Å–º–µ—Ä—Ç–∏—è')

plt.tight_layout()
plt.show()

"""–ó–∞–º–µ—Ç–∏–º, —á—Ç–æ –ª–∏–Ω–µ–π–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–µ—Ç

–ò–∑-–∑–∞ –Ω–µ–ª–∏–Ω–µ–π–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –æ—á–µ–Ω—å –º–∞–ª—ã—Ö –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π —Å —Ü–µ–ª–µ–≤—ã–º –ø—Ä–∏–∑–Ω–∞–∫–æ–º, –Ω–µ–±–æ–ª—å—à–∏–º —Ä–∞–∑–º–µ—Ä–æ–º –ø—Ä–∏–∑–Ω–∞–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏ –≤—ã–±–æ—Ä–∫–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –º–æ–¥–µ–ª—è–º–∏ —Å –Ω–µ–≤—ã—Å–æ–∫–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é:

* `Decision Tree Regressor` (—Å—Ç—Ä–æ–∏—Ç –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∞–≤–∏–ª ¬´–µ—Å–ª–∏-—Ç–æ¬ª –ø—É—Ç–µ–º —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–∞ –æ–±–ª–∞—Å—Ç–∏, —á—Ç–æ–±—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∏—Å–ø–µ—Ä—Å–∏—é —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ –∫–∞–∂–¥–æ–º –ª–∏—Å—Ç–µ)
* `Random Forest Regressor` (–æ–±—É—á–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –≥–ª—É–±–æ–∫–∏—Ö –¥–µ—Ä–µ–≤—å–µ–≤ –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–¥–≤—ã–±–æ—Ä–∫–∞—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –∞ –∏—Ç–æ–≥–æ–≤–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—É—Ç–µ–º —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –≤—Å–µ—Ö –¥–µ—Ä–µ–≤—å–µ–≤ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Ä–∞–∑–±—Ä–æ—Å–∞)
* `Gradient Boosting Regressor` ( —Å—Ç—Ä–æ–∏—Ç –∞–Ω—Å–∞–º–±–ª—å –¥–µ—Ä–µ–≤—å–µ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –≥–¥–µ –∫–∞–∂–¥–∞—è –Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å –æ–±—É—á–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ - –∞–Ω—Ç–∏–≥—Ä–∞–¥–∏–µ–Ω—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å - –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –º–æ–¥–µ–ª–µ–π)

–í—ã–±–µ—Ä–µ–º —Å–ª–µ–¥—É—é—â–∏–π –ø—É–ª –º–µ—Ç—Ä–∏–∫ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–µ–π:

* `MAE` (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏)
* `MSE` (–¥–ª—è —à—Ç—Ä–∞—Ñ–æ–≤–∞–Ω–∏—è –±–æ–ª—å—à–∏—Ö –æ—à–∏–±–æ–∫)
* `MAPE` (–¥–ª—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π)
* `R^2` (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ä–µ–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º)

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏

–û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è:
* $y_i$ - –∏—Å—Ç–∏–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è $i$-–≥–æ –æ–±—ä–µ–∫—Ç–∞.
* $\hat{y}_i$ - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è $i$-–≥–æ –æ–±—ä–µ–∫—Ç–∞.
* $\bar{y}$ - —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å—Ç–∏–Ω–Ω–æ–π —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.
* $n$ - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –≤—ã–±–æ—Ä–∫–µ.

#### 1. Mean Absolute Error (MAE)

$$ MAE = \frac{1}{n} \sum_{i=1}^{n} |y_i - \hat{y}_i| $$

#### 2. Mean Squared Error (MSE)

$$ MSE = \frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2 $$

#### 3. Mean Absolute Percentage Error (MAPE)

$$ MAPE = \frac{100\%}{n} \sum_{i=1}^{n} \left| \frac{y_i - \hat{y}_i}{y_i} \right| $$

#### 4. –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–∏ ($R^2$)

$$ R^2 = 1 - \frac{\sum_{i=1}^{n} (y_i - \hat{y}_i)^2}{\sum_{i=1}^{n} (y_i - \bar{y})^2} $$

–í –∫–∞—á–µ—Å—Ç–≤–µ —Ü–µ–ª–µ–≤–æ–π –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º `MSE` –¥–ª—è –Ω–∞–∏–±–æ–ª–µ–µ —è–≤–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ—à–∏–±–∫–∏

–°—Ñ–æ—Ä–º–∏—Ä—É–µ–º —Å–µ—Ç–∫–∏ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
"""

dtr_params = {
    'max_depth': ('int', [3, 7]),
    'criterion': ('cat', ['squared_error', 'absolute_error', 'poisson']),
    'min_samples_split': ('int', [2, 10])
}

rf_params = {
    'n_estimators': ('cat', [50, 100, 300]),
    'max_depth': ('int', [3, 7]),
    'min_samples_split': ('int', [2, 10])
}

gbr_params = {
    'n_estimators': ('cat', [50, 100, 300]),
    'max_depth': ('int', [3, 7]),
    'min_samples_split': ('int', [2, 10]),
    'loss': ('cat', ['squared_error', 'absolute_error', 'huber', 'quantile'])
}

""""–û–±–µ—Ä—Ç–∫–∞" –Ω–∞–¥ optuna"""

import optuna
from sklearn.model_selection import cross_val_score


def gen_objective(estimator_class, grid, X_train, y_train, **kwargs):
    def objective(trial):
        params = {}
        for k, v in grid.items():
            if v[0] == 'cat':
                params[k] = trial.suggest_categorical(k, v[1])
            elif v[0] == 'int':
                params[k] = trial.suggest_int(k, *v[1])
            elif v[0] == 'float':
                params[k] = trial.suggest_float(k, *v[1], log=True)

        regressor = estimator_class(**params)

        mse_scores = cross_val_score(regressor, X_train, y_train, cv=5, scoring='neg_mean_squared_error')
        return -mse_scores.mean()

    return objective

def get_best_params(X, y, model, params):
    my_objective = gen_objective(model, params, X, y)
    study = optuna.create_study(direction="minimize")
    study.optimize(my_objective, n_trials=10)
    return study.best_params

from sklearn.metrics import mean_absolute_error, mean_squared_error, mean_absolute_percentage_error, r2_score

"""–§—É–Ω–∫—Ü–∏—è, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∞—è –º–µ—Ç—Ä–∏–∫–∏ –º–æ–¥–µ–ª–∏"""

def get_metrics(model_name, y_test, y_pred):
    mse = mean_squared_error(y_test, y_pred)
    mae = mean_absolute_error(y_test, y_pred)
    mape = mean_absolute_percentage_error(y_test, y_pred)
    r2 = r2_score(y_test, y_pred)
    return model_name, {'MAE': mae, 'MSE': mse, 'MAPE': mape, 'R2': r2}

"""–î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –º–µ—Ç—Ä–∏–∫ –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å–ª–æ–≤–∞—Ä–µ"""

metdct = {}

"""# 4. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π ML –∏ –ø–æ–¥–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ <a class="anchor" id="chapter4"></a> [‚Üë](#toc)

–î–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞ `new_feat`

1. `Decision Tree Regressor`
"""

X_train_new_feat.shape

X_train_pure.shape

y_train_pure.shape

y_train_aligned

from sklearn.tree import DecisionTreeRegressor

new_feat_dtr = DecisionTreeRegressor(**get_best_params(X_train_new_feat, y_train_pure, DecisionTreeRegressor, dtr_params))
new_feat_dtr.fit(X_train_new_feat, y_train_pure)
y_pr = new_feat_dtr.predict(X_test_new_feat)
name, vals = mtrs = get_metrics('new_feat - DTR', y_test_pure, y_pr)
metdct[name] = vals
mtrs

"""2. `Random Forest Regressor`"""

from sklearn.ensemble import RandomForestRegressor

new_feat_rf = RandomForestRegressor(**get_best_params(X_train_new_feat, y_train_pure, RandomForestRegressor, rf_params))
new_feat_rf.fit(X_train_new_feat, y_train_pure)
y_pr = new_feat_rf.predict(X_test_new_feat)
name, vals = mtrs = get_metrics('new_feat - RF', y_test_pure, y_pr)
metdct[name] = vals
mtrs

"""3. `Gradient Boosting Regressor`"""

from sklearn.ensemble import GradientBoostingRegressor

new_feat_gbr = GradientBoostingRegressor(**get_best_params(X_train_new_feat, y_train_pure, GradientBoostingRegressor, gbr_params))
new_feat_gbr.fit(X_train_new_feat, y_train_pure)
y_pr = new_feat_gbr.predict(X_test_new_feat)
name, vals = mtrs = get_metrics('new_feat - GBR', y_test_pure, y_pr)
metdct[name] = vals
mtrs

"""–î–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞ `scaled`

1. `Decision Tree Regressor`
"""

scaled_dtr = DecisionTreeRegressor(**get_best_params(X_train_scaled, y_train_pure, DecisionTreeRegressor, dtr_params))
scaled_dtr.fit(X_train_scaled, y_train_pure)
y_pr = scaled_dtr.predict(X_test_scaled)
name, vals = mtrs = get_metrics('scaled - DTR', y_test_pure, y_pr)
metdct[name] = vals
mtrs

"""2. `Random Forest Regressor`"""

scaled_rf = RandomForestRegressor(**get_best_params(X_train_scaled, y_train_pure, RandomForestRegressor, rf_params))
scaled_rf.fit(X_train_scaled, y_train_pure)
y_pr = scaled_rf.predict(X_test_scaled)
name, vals = mtrs = get_metrics('scaled - RF', y_test_pure, y_pr)
metdct[name] = vals
mtrs

"""3. `Gradient Boosting Regressor`"""

scaled_gbr = GradientBoostingRegressor(**get_best_params(X_train_scaled, y_train_pure, GradientBoostingRegressor, gbr_params))
scaled_gbr.fit(X_train_scaled, y_train_pure)
y_pr = scaled_gbr.predict(X_test_scaled)
name, vals = mtrs = get_metrics('scaled - GBR', y_test_pure, y_pr)
metdct[name] = vals
mtrs

"""–î–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞ `mm`

1. `Decision Tree Regressor`
"""

mm_dtr = DecisionTreeRegressor(**get_best_params(X_train_minmax, y_train_pure, DecisionTreeRegressor, dtr_params))
mm_dtr.fit(X_train_minmax, y_train_pure)
y_pr = mm_dtr.predict(X_test_minmax)
name, vals = mtrs = get_metrics('mm - DTR', y_test_pure, y_pr)
metdct[name] = vals
mtrs

"""2. `Random Forest Regressor`"""

mm_rf = RandomForestRegressor(**get_best_params(X_train_minmax, y_train_pure, RandomForestRegressor, rf_params))
mm_rf.fit(X_train_minmax, y_train_pure)
y_pr = mm_rf.predict(X_test_minmax)
name, vals = mtrs = get_metrics('mm - RF', y_test_pure, y_pr)
metdct[name] = vals
mtrs

"""3. `Gradient Boosting Regressor`"""

mm_gbr = GradientBoostingRegressor(**get_best_params(X_train_minmax, y_train_pure, GradientBoostingRegressor, gbr_params))
mm_gbr.fit(X_train_minmax, y_train_pure)
y_pr = mm_gbr.predict(X_test_minmax)
name, vals = mtrs = get_metrics('mm - GBR', y_test_pure, y_pr)
metdct[name] = vals
mtrs

"""–î–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞ `robust`

1. `Decision Tree Regressor`
"""

rob_dtr = DecisionTreeRegressor(**get_best_params(X_train_robust, y_train_pure, DecisionTreeRegressor, dtr_params))
rob_dtr.fit(X_train_robust, y_train_pure)
y_pr = rob_dtr.predict(X_test_robust)
name, vals = mtrs = get_metrics('robust - DTR', y_test_pure, y_pr)
metdct[name] = vals
mtrs

"""2. `Random Forest Regressor`"""

rob_fr = RandomForestRegressor(**get_best_params(X_train_robust, y_train_pure, RandomForestRegressor, rf_params))
rob_fr.fit(X_train_robust, y_train_pure)
y_pr = rob_fr.predict(X_test_robust)
name, vals = mtrs = get_metrics('robust - RF', y_test_pure, y_pr)
metdct[name] = vals
mtrs

"""3. `Gradient Boosting Regressor`"""

rob_gbr = GradientBoostingRegressor(**get_best_params(X_train_robust, y_train_pure, GradientBoostingRegressor, gbr_params))
rob_gbr.fit(X_train_robust, y_train_pure)
y_pr = rob_gbr.predict(X_test_robust)
name, vals = mtrs = get_metrics('robust - GBR', y_test_pure, y_pr)
metdct[name] = vals
mtrs

"""# 5. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö <a class="anchor" id="chapter5"></a> [‚Üë](#toc)

–°—Ñ–æ—Ä–º–∏—Ä–∏—É–µ–º —Ç–∞–±–ª–∏—Ü—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
"""

metric_table = pd.DataFrame(metdct).T
metric_table

"""–í—Å–µ —á–µ—Ç—ã—Ä–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –Ω–∞–∏–ª—É—á—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏–µ —É –º–æ–¥–µ–ª–∏ `scaled - GBR` üéâ

# 6. –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã <a class="anchor" id="chapter6"></a> [‚Üë](#toc)

–í —Ö–æ–¥–µ —Ä–∞–±–æ—Ç—ã –±—ã–ª –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∞–Ω –¥–∞—Ç–∞—Å–µ—Ç, –∏ –æ–±—É—á–µ–Ω–æ 12 –º–æ–¥–µ–ª–µ–π –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–∞—Ä–∏–∞—Ü–∏—è—Ö –¥–∞–Ω–Ω—ã—Ö. –õ—É—á—à–µ –≤—Å–µ–≥–æ —Å–µ–±—è –ø–æ–∫–∞–∑–∞–ª–∞ –º–æ–¥–µ–ª—å `Gradient Boosting Regressor`, –æ–±—É—á–µ–Ω–Ω–∞—è –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º `StandartScaler`. –£ –¥–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ - –Ω–∞–∏–ª—É—á—à–∏–µ
"""